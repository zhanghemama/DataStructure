极客时间学习笔记之哈希算法，

# 定义
将任意长度的二进制串儿映射成固定长度的二进制串，这个映射规则就是哈希算法。将原始数据映射成的二进制串就是哈希值。
哈希算法满足的要求：
1. 从哈希值不能反向推导出元数据；
2.对输入数据非常敏感，哪怕原始数据只是修改了一个bit，算出的哈希值也大不相同；
3.散列冲突的概率要小，对于不同的原始数据，哈希值相同的概率非常小；不管是什么样的哈希算法，我们只能做到尽量减少碰撞冲突和概率，理论上是没办法做到完全不冲突的；这个是基于鸽巢原理，意思就是说11只鸽子，10个巢，那么肯定有一个巢里鸽子的数量多于1；哈希值是固定128bit的二进制串儿，只能表示2^128个数据，如果我们要对2^128+1个数据求哈希值，就必然会存在哈希值相同的情况；
4.哈希算法执行要尽量高效；

# 安全加密
比如存储用户的密码，是将密码先根据加密算法算出哈希值，将哈希值存储。还可以先对明文密码加salt，然后再计算哈希值。

# 唯一标识
比如我们要在海量图库中搜索一张图片是否存在，我们可以从图片的二进制串开头取100个字节，中间取100个字节，从最后取100个字节，然后将这300个字节放在一起计算哈希值，得到一个哈希字符串，作为图片的唯一标识，唯一标识组合图片路径存成散列表。我们要搜索图片是否存在的时候只需要先计算图片的唯一标识，然后在去散列表中查找；如果存在，我们取出图片的存储路径，获取到这个图片，再做进一步的比对；

# 数据校验

BT下载一个电影，电影文件会被分成多个文件块儿，等所有的文件都下载完成后，再组装成一个完整的电影文件；
但是网络传输是不安全，如果下载的文件被恶意修改过，或者下载过程中出现错误，所有下载的文件块儿可能是不完整的；如果我们没有能力检测出这种恶意修改或者文件下载出错，就会导致电影无法观看，或者导致电脑中毒。那么如何来校验文件块儿的安全正确完整呢？
我们通过哈希算法，对每个文件块儿算哈希值，并且保存在种子文件中，下载完成后，对下载的文件块儿再重新计算哈希值，并且与保存在种子文件中的做对比，如果不一样说明文件出错了，再重新下载。

# 散列函数
散列表中提到，散列函数是设计一个散列表的关键，它直接解决了散列冲突的概率和散列表的性能；相对哈希算法的应用，散列函数对于散列冲突的要求低很多，即便出现，也可以通过开放寻址和链表发解决；散列函数更关心，散列后的值是否能均匀分布；散列函数执行的快慢也会影响散列表的性能；所以一般散列函数都比较简单，比较追求效率；

# 负载均衡
如何保证同一个客户端上，一次会话中的所有请求都路由到同一个服务器上；
可以通过哈希算法，对客户端的ip地址或者会话id计算哈希表，然后将哈希表与服务器列表的大小取模，得到要路由到的服务器的编号。这样就可以保证将同一个ip过来的所有请求都路由到同一个服务器上；

# 数据分片

1.有1T的日志文件，里面记录了用户的搜索关键词，我们想快速统计出每个关键词被搜索的次数，该怎么办？
我们可以先对数据进行分片，采用多台机器处理的方法，来提高处理速度；我们用n台机器并行处理，我们从搜索记录的日志文件中，依次读出每个搜索关键词，通过计算哈希值，再跟n取模，最终得出交给哪个机器编号处理。这样相同的搜索关键词被分配到同一台机器上，每个机器都会算出关键词出现的次数，最后再将结果合并；

2.快速判断图片是否在图库中
刚刚讲到了利用唯一标识来构建散列表，但是1亿张图片超过了单台机器的内存上限；
同样对数据进行分片，准备n台机器，每台机器只维护某一部分图片对应的散列表；每次从图库中读取一个文件，计算唯一标识，然后与机器个数n取模，得到的值就是要分配机器的编号，将图片的唯一标识和图片存储路径构建散列表；判断图片是否存在于图库中时，用同样的方法计算哈希值然后与机器个数取模，得到机器编号，再到对应机器上的散列表中查找；
